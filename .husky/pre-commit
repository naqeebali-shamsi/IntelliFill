#!/bin/sh

# Run lint-staged for code formatting
npx lint-staged

# Validate lockfile is in sync when package.json changes are staged
if git diff --cached --name-only | grep -q 'package\.json$'; then
  echo "Checking pnpm-lock.yaml is in sync with package.json..."

  # Use --frozen-lockfile to validate without modifying anything
  if ! pnpm install --frozen-lockfile --ignore-scripts >/dev/null 2>&1; then
    echo ""
    echo "ERROR: pnpm-lock.yaml is out of sync with package.json!"
    echo ""
    echo "Fix: Run 'pnpm install' and stage the updated lockfile:"
    echo "  pnpm install"
    echo "  git add pnpm-lock.yaml"
    echo ""
    exit 1
  fi
fi
