---
phase: 02-intelligence
plan: 03
type: execute
wave: 2
depends_on: ['02-01']
files_modified:
  - quikadmin-web/src/components/smart-profile/ConfidenceReview/index.tsx
  - quikadmin-web/src/components/smart-profile/ConfidenceReview/ReviewField.tsx
  - quikadmin-web/src/components/smart-profile/ConfidenceReview/FieldConflict.tsx
  - quikadmin-web/src/components/smart-profile/index.ts
  - quikadmin-web/src/pages/SmartProfile.tsx
  - quikadmin-web/src/stores/smartProfileStore.ts
autonomous: true
---

<objective>
ConfidenceReview step for low-certainty fields and field conflicts.

Purpose: Show users only the fields that need attention - low confidence extractions and conflicting values from multiple documents. High confidence fields pass through silently.

Output: ConfidenceReview component integrated into wizard, users can review/correct flagged fields before proceeding to profile view.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-intelligence/02-RESEARCH.md
@.planning/phases/02-intelligence/02-01-SUMMARY.md

# Source files

@quikadmin-web/src/pages/SmartProfile.tsx
@quikadmin-web/src/stores/smartProfileStore.ts
@quikadmin-web/src/components/smart-profile/index.ts
@quikadmin-web/src/components/smart-profile/ConfidenceBadge.tsx
@quikadmin-web/src/components/smart-profile/FieldSourcePill.tsx
@quikadmin-web/src/components/smart-profile/EditableField.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create ReviewField component</name>
  <files>quikadmin-web/src/components/smart-profile/ConfidenceReview/ReviewField.tsx</files>
  <action>
Create component for reviewing a single low-confidence field.

**ReviewField.tsx:**

```typescript
interface ReviewFieldProps {
  fieldName: string;
  value: unknown;
  confidence: number;
  source: {
    documentId: string;
    documentName: string;
  };
  onValueChange: (newValue: unknown) => void;
  onConfirm: () => void;
}
```

Implement:

1. Card-style layout with field name as header (human-readable label)
2. Current value displayed prominently
3. ConfidenceBadge showing extraction confidence
4. Source pill showing "From: {documentName}"
5. Editable input for correction (use existing EditableField pattern or simple input)
6. "Confirm" button to mark as reviewed
7. Visual state: when confirmed, show checkmark and muted styling

Field name formatting: Convert camelCase/snake_case to "Title Case" (e.g., "firstName" â†’ "First Name").

Use status-warning colors for the card border (these are fields needing attention).
</action>
<verify>TypeScript compiles: `cd quikadmin-web && npx tsc --noEmit`</verify>
<done>

- ReviewField.tsx created with editable value
- Shows confidence and source information
- Confirm action marks field as reviewed
- Visual distinction between pending and confirmed fields
  </done>
  </task>

<task type="auto">
  <name>Task 2: Create FieldConflict component</name>
  <files>quikadmin-web/src/components/smart-profile/ConfidenceReview/FieldConflict.tsx</files>
  <action>
Create component for resolving conflicts when multiple documents have different values.

**FieldConflict.tsx:**

```typescript
interface ConflictValue {
  value: unknown;
  source: {
    documentId: string;
    documentName: string;
    confidence: number;
  };
}

interface FieldConflictProps {
  fieldName: string;
  values: ConflictValue[];
  selectedIndex: number;
  onSelect: (index: number) => void;
  onCustomValue: (value: unknown) => void;
}
```

Implement:

1. Card with field name header + "Conflicting values detected" subtitle
2. List of options, each showing:
   - Value (formatted appropriately for type)
   - Source document name
   - Confidence badge
   - Radio button for selection
3. Currently selected option highlighted with primary color
4. "Use custom value" option at bottom with input field
5. Helper text: "Select which value to use, or enter a custom value"

For name conflicts specifically, show message: "Both spellings may be valid (transliteration variants)".
</action>
<verify>TypeScript compiles</verify>
<done>

- FieldConflict.tsx created with multi-value selection
- Radio buttons for choosing between values
- Custom value option available
- Helpful messaging for transliteration cases
  </done>
  </task>

<task type="auto">
  <name>Task 3: Create ConfidenceReview main component</name>
  <files>quikadmin-web/src/components/smart-profile/ConfidenceReview/index.tsx</files>
  <action>
Create the main review step orchestrating low-confidence fields and conflicts.

**ConfidenceReview/index.tsx:**

```typescript
interface ConfidenceReviewProps {
  lowConfidenceFields: Array<{
    fieldName: string;
    value: unknown;
    confidence: number;
    documentId: string;
    documentName: string;
  }>;
  conflicts: Array<{
    fieldName: string;
    values: Array<{
      value: unknown;
      source: {
        documentId: string;
        documentName: string;
        confidence: number;
      };
    }>;
    selectedIndex: number;
  }>;
  onFieldUpdate: (fieldName: string, value: unknown) => void;
  onConflictResolve: (fieldName: string, selectedIndex: number) => void;
  onComplete: () => void;
}
```

Implement:

1. Header with count: "{N} fields need your review"
2. Section for low confidence fields (if any):
   - Map over lowConfidenceFields, render ReviewField for each
   - Track which fields have been confirmed locally
3. Section for conflicts (if any):
   - Map over conflicts, render FieldConflict for each
4. Progress indicator: "X of Y reviewed"
5. "Confirm All" button - enabled only when all fields reviewed/resolved
6. Auto-skip behavior: If no fields to review, call onComplete immediately (useEffect)
7. Empty state: "All fields extracted with high confidence!" with checkmark icon

Use AlertCircle icon and status-warning colors for the header to indicate attention needed.
</action>
<verify>TypeScript compiles: `cd quikadmin-web && npx tsc --noEmit`</verify>
<done>

- ConfidenceReview/index.tsx created
- Shows low confidence fields and conflicts
- Progress tracking for reviewed fields
- Auto-skips when nothing to review
- Confirm All enables when all fields handled
  </done>
  </task>

<task type="auto">
  <name>Task 4: Wire ConfidenceReview into SmartProfile wizard</name>
  <files>
quikadmin-web/src/components/smart-profile/index.ts,
quikadmin-web/src/pages/SmartProfile.tsx,
quikadmin-web/src/stores/smartProfileStore.ts
  </files>
  <action>
Integrate ConfidenceReview into the wizard and connect to store.

**smart-profile/index.ts:**
Add export: `export { ConfidenceReview } from './ConfidenceReview';`

**smartProfileStore.ts:**
Add state and actions for conflicts if not present:

```typescript
// State
conflicts: FieldConflict[];

// Actions
setConflicts: (conflicts: FieldConflict[]) => void;
resolveConflict: (fieldName: string, selectedIndex: number) => void;
```

Update LowConfidenceField type if needed to include documentName.

**SmartProfile.tsx:**
Replace ReviewStepContent placeholder with real ConfidenceReview:

1. Import ConfidenceReview from smart-profile
2. In ReviewStepContent:
   - Get lowConfidenceFields, conflicts from store
   - Render ConfidenceReview with props
   - onFieldUpdate: call updateProfileField + markFieldAsEdited
   - onConflictResolve: call resolveConflict
   - onComplete: call setStep(getNextStep())

3. Update handleNext logic:
   - After grouping step, check if lowConfidenceFields.length > 0 or conflicts.length > 0
   - If yes, go to 'review' step
   - If no, skip to 'profile' step
     </action>
     <verify>

- `cd quikadmin-web && bun run build` succeeds
- Manual test: Upload doc with low confidence field, verify review step shows it
- Edit value and confirm, verify profile shows updated value
  </verify>
  <done>
- ConfidenceReview exported from smart-profile/index.ts
- ReviewStepContent renders ConfidenceReview (not placeholder)
- Field updates flow to profileData in store
- Conflict resolution updates selected value
- Review step skips when nothing to review
  </done>
  </task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `cd quikadmin-web && bun run build` succeeds
- [ ] ReviewField shows field with edit capability
- [ ] FieldConflict shows multiple values with selection
- [ ] ConfidenceReview auto-skips when nothing to review
- [ ] Field edits persist to profileData
- [ ] Wizard flows through review step correctly
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- Low confidence fields displayed for review
- Conflicts show value options with selection
- Field edits update the profile
- Review step integrated into wizard flow
  </success_criteria>

<output>
After completion, create `.planning/phases/02-intelligence/02-03-SUMMARY.md`
</output>
