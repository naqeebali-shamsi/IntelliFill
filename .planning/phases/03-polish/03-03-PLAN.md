# Plan 03-03: Assisted/Express Mode

**Phase:** 03-polish
**Wave:** 1
**Autonomous:** true

## Goal

User preference toggle for wizard behavior. Assisted mode provides more guidance and review steps; Express mode auto-skips for power users with high-confidence extractions.

## Prerequisites

- Phase 2 complete (confidence review step, auto-skip logic exists)
- Zustand 5.0 with persist middleware available

## Tasks

### Task 1: Create userPreferencesStore with persist

**Files:**

- `quikadmin-web/src/stores/userPreferencesStore.ts` (new)

**Store definition:**

```typescript
import { create } from 'zustand';
import { persist } from 'zustand/middleware';

export type WizardMode = 'assisted' | 'express';

interface UserPreferencesState {
  wizardMode: WizardMode;
  setWizardMode: (mode: WizardMode) => void;
}

export const useUserPreferencesStore = create<UserPreferencesState>()(
  persist(
    (set) => ({
      wizardMode: 'assisted', // Default for new users
      setWizardMode: (mode) => set({ wizardMode: mode }),
    }),
    {
      name: 'user-preferences', // localStorage key
    }
  )
);
```

**Behavior:**

- Persists to localStorage automatically
- Default to 'assisted' for safety (new users get full guidance)
- Simple toggle, no complex state

### Task 2: Build ModeToggle component

**Files:**

- `quikadmin-web/src/components/smart-profile/ModeToggle/index.tsx` (new)

**Component:**

```typescript
// Uses Switch from @/components/ui/switch
// Shows "Assisted" label on left, "Express" label on right
// Tooltip explains the difference:
// - Assisted: "Review each step for accuracy"
// - Express: "Auto-skip high-confidence steps"
```

**Props:**

- None (reads/writes directly to useUserPreferencesStore)

**UI Pattern:**

```tsx
<div className="flex items-center gap-2">
  <span className="text-sm text-muted-foreground">Assisted</span>
  <Switch
    checked={wizardMode === 'express'}
    onCheckedChange={(checked) => setWizardMode(checked ? 'express' : 'assisted')}
  />
  <span className="text-sm text-muted-foreground">Express</span>
</div>
```

### Task 3: Integrate mode logic into SmartProfile

**Files:**

- `quikadmin-web/src/pages/SmartProfile.tsx` (modify)

**Changes:**

1. Import `useUserPreferencesStore` and `ModeToggle`
2. Add ModeToggle to wizard header (near step indicator)
3. Modify auto-skip threshold based on mode:

```typescript
const wizardMode = useUserPreferencesStore((s) => s.wizardMode);

// Existing shouldSkipReview logic
const shouldSkipReview =
  lowConfidenceFields.length === 0 &&
  conflicts.length === 0 &&
  minConfidence >= (wizardMode === 'express' ? 0.9 : 0.85);
```

4. Express mode behavior:
   - Higher confidence threshold for auto-skip (90% vs 85%)
   - Skip grouping step if only 1 person detected (regardless of mode)
   - Optional: Skip profile step if all fields high confidence

**Edge case:**

- Mode change mid-wizard should NOT restart wizard
- Mode only affects future step transitions, not current step

## Verification

- [ ] `bun run build` succeeds
- [ ] ModeToggle appears in wizard header
- [ ] Switching mode persists across page refresh
- [ ] Express mode auto-skips review at 90% confidence
- [ ] Assisted mode requires 85% for auto-skip

## Commit Format

```
feat(03-03): {task-name}
```

---

_Plan created: 2026-01-16_
