---
phase: 01-foundation
plan: 02
type: execute
---

<objective>
Create the Smart Upload Zone with react-dropzone and document type auto-detection.

Purpose: Allow users to drag-drop documents and see detected types with confidence badges.
Output: Working upload zone component, detect-types API endpoint, file cards with detection results.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation/01-RESEARCH.md
@.planning/phases/01-foundation/01-01-SUMMARY.md

**Codebase patterns:**
@quikadmin-web/src/components/features/file-upload-zone.tsx (existing upload component)
@quikadmin/src/api/client-documents.routes.ts (OCR integration patterns)

**Tech stack:**

- react-dropzone (install if needed: bun add react-dropzone@latest)
- Framer Motion for animations (already in stack)

**Key decisions:**

- Accept PDF, JPG, PNG up to 10MB
- Auto-detect document type using existing OCR patterns
- Confidence threshold: 60% for "detected", below shows "Unknown"
  </context>

<tasks>

<task type="auto">
  <name>Task 1: Create detect-types backend endpoint</name>
  <files>quikadmin/src/api/smart-profile.routes.ts, quikadmin/src/app.ts</files>
  <action>
Create new smart-profile routes file:

1. Create `smart-profile.routes.ts` with Router
2. Implement `POST /api/smart-profile/detect-types`:
   - Accept multipart/form-data with files[]
   - For each file, call existing OCR service to get quick classification
   - Return array of { fileId, fileName, detectedType, confidence }
   - Supported types: PASSPORT, EMIRATES_ID, DRIVERS_LICENSE, BANK_STATEMENT, OTHER
   - Use lightweight detection (first page only, pattern matching)

3. Add authentication middleware (authenticateSupabase)
4. Mount routes in app.ts under /api/smart-profile

Reference existing extractFieldsByCategory() logic in client-documents.routes.ts for document type patterns. DO NOT duplicate - refactor to share if needed, or create a simple detection function.

Handle errors gracefully - if OCR fails, return type: 'OTHER', confidence: 0.
</action>
<verify>curl -X POST http://localhost:3002/api/smart-profile/detect-types with test PDF returns detection result</verify>
<done>Endpoint returns document type and confidence for uploaded files</done>
</task>

<task type="auto">
  <name>Task 2: Create SmartUploadZone component</name>
  <files>quikadmin-web/src/components/smart-profile/SmartUploadZone.tsx, quikadmin-web/src/components/smart-profile/FileCard.tsx, quikadmin-web/src/components/smart-profile/ConfidenceBadge.tsx</files>
  <action>
Create upload zone following react-dropzone patterns from RESEARCH.md:

**SmartUploadZone.tsx:**

1. Use useDropzone hook with accept config for PDF/JPG/PNG, maxSize 10MB
2. On drop, add files to smart-profile store
3. For each file, call detect-types API
4. Update store with detection results
5. Show drag-active state with visual feedback
6. Render FileCard for each uploaded file
7. Use AnimatePresence for smooth file card animations

**FileCard.tsx:**

1. Show file name, size, thumbnail (if image)
2. Show detected type with ConfidenceBadge
3. Allow manual type override via dropdown
4. Show remove button
5. States: uploading, detected, error

**ConfidenceBadge.tsx:**

1. High (>=85%): Green checkmark, "Verified"
2. Medium (60-84%): Yellow alert, "Review suggested"
3. Low (<60%): Red, "Please verify"
4. Use semantic tokens (text-status-success, etc.)

Install react-dropzone if not present: `bun add react-dropzone@latest`

DO NOT show raw percentages to users - only show labels.
</action>
<verify>Component renders, drag-drop works, files display with detected types</verify>
<done>Files can be dropped, auto-detected, shown with confidence badges</done>
</task>

<task type="auto">
  <name>Task 3: Integrate upload zone into wizard</name>
  <files>quikadmin-web/src/pages/SmartProfile.tsx</files>
  <action>
Replace upload step placeholder with SmartUploadZone:

1. Import SmartUploadZone component
2. Render in 'upload' step case
3. Add "Continue" button enabled when files.length > 0
4. On continue, transition to next step (grouping or review based on file count)
5. Show file count summary: "X documents ready"

For MVP, skip grouping step (go directly to profile view). Multi-person grouping is Phase 2.
</action>
<verify>Full flow: drop files → see detection → click Continue → moves to profile step</verify>
<done>Upload step integrated, files persist in store, navigation to next step works</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] Backend: `cd quikadmin && npm run build` succeeds
- [ ] Frontend: `cd quikadmin-web && bun run build` succeeds
- [ ] Drop PDF file → shows detected type
- [ ] Drop JPG/PNG → shows detected type
- [ ] Confidence badge shows appropriate color/label
- [ ] Manual type override works
- [ ] Files persist across wizard steps
- [ ] Continue button navigates to next step
</verification>

<success_criteria>

- detect-types endpoint works with PDF/image files
- SmartUploadZone renders with drag-drop functionality
- FileCard shows file info with detected type
- ConfidenceBadge shows semantic labels (not percentages)
- Files stored in Zustand, persist across steps
  </success_criteria>

<output>
After completion, create `.planning/phases/01-foundation/01-02-SUMMARY.md`
</output>
