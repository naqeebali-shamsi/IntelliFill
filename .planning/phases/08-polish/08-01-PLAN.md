---
phase: 08-polish
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - quikadmin-web/src/pages/Settings.tsx
  - quikadmin-web/src/components/features/OrganizationTabContent.tsx
  - quikadmin-web/src/components/layout/AppLayout.tsx
  - quikadmin-web/src/components/settings/SecurityTabContent.tsx
autonomous: true

must_haves:
  truths:
    - "Account settings show sub-tabs: Profile, Organization, Security"
    - "Organization sub-tab only visible to admin/owner roles"
    - "Security sub-tab has password change, session management, 2FA scaffold"
    - "Organization no longer appears in main sidebar navigation"
    - "Default tab is Profile regardless of user role"
  artifacts:
    - path: "quikadmin-web/src/pages/Settings.tsx"
      provides: "Unified Account with sub-tabs"
      contains: "sub-tab navigation"
    - path: "quikadmin-web/src/components/settings/SecurityTabContent.tsx"
      provides: "Security hub with password, sessions, 2FA"
      min_lines: 100
    - path: "quikadmin-web/src/components/layout/AppLayout.tsx"
      provides: "Updated navigation without Organization"
      contains: "baseNavigation"
  key_links:
    - from: "Settings.tsx"
      to: "OrganizationTabContent.tsx"
      via: "conditional render in sub-tab"
      pattern: "isAdmin.*Organization"
    - from: "Settings.tsx"
      to: "SecurityTabContent.tsx"
      via: "sub-tab import"
      pattern: "SecurityTabContent"
---

<objective>
Consolidate Settings page by merging Organization into Account as sub-tabs and creating a proper Security hub.

Purpose: Simplify settings navigation for solo users (most don't need org settings visible) while keeping power features accessible for admins/owners.
Output: Unified Account settings with Profile/Organization/Security sub-tabs.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/08-polish/08-CONTEXT.md

@quikadmin-web/src/pages/Settings.tsx
@quikadmin-web/src/components/features/OrganizationTabContent.tsx
@quikadmin-web/src/components/layout/AppLayout.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create SecurityTabContent component</name>
  <files>quikadmin-web/src/components/settings/SecurityTabContent.tsx</files>
  <action>
Create a new SecurityTabContent component that consolidates security-related settings:

1. **Password Section:**
   - Show "Last changed: X ago" with Change Password button
   - Reuse existing ChangePasswordModal integration

2. **Two-Factor Authentication Section:**
   - Show enabled/disabled status with badge
   - Enable 2FA button (uses existing TwoFactorSetupModal)
   - Manage 2FA button when enabled

3. **Active Sessions Section (scaffold):**
   - List placeholder for "Current session" with browser/device info
   - "Sign out all other sessions" button (scaffold - shows toast "Coming soon")
   - Use SettingsSection/SettingsRow patterns from Settings.tsx

4. **Security Recommendations Section (scaffold):**
   - Show checklist: Password strength, 2FA status, Email verified
   - Use CheckCircle2 for complete, AlertCircle for incomplete

Export the component and add it to the settings/index.ts barrel export.

Use existing UI components: Button, Badge, SettingsSection, SettingsRow patterns.
  </action>
  <verify>
File exists at quikadmin-web/src/components/settings/SecurityTabContent.tsx
Component exports SecurityTabContent
TypeScript compiles: `cd quikadmin-web && bun run typecheck`
  </verify>
  <done>
SecurityTabContent component created with password, 2FA, sessions, and recommendations sections.
  </done>
</task>

<task type="auto">
  <name>Task 2: Restructure Settings page with sub-tabs</name>
  <files>quikadmin-web/src/pages/Settings.tsx</files>
  <action>
Restructure the Settings page to use sub-tabs under Account:

1. **Replace navItems array:**
   - Remove 'organization' and 'security' from main navItems
   - Keep: general, account, notifications, advanced

2. **Add sub-tab navigation inside 'account' tab content:**
   - Create accountSubTabs: [{ id: 'profile', label: 'Profile', icon: User }, { id: 'organization', label: 'Organization', icon: Building2 }, { id: 'security', label: 'Security', icon: Shield }]
   - Add state: const [activeAccountSubTab, setActiveAccountSubTab] = useState('profile')
   - Render horizontal sub-tab buttons above account content

3. **Conditional Organization visibility:**
   - Get user role from useBackendAuthStore
   - Only show Organization sub-tab if user.role is 'ADMIN' or 'OWNER'
   - Use: `const isAdminOrOwner = user?.role === 'ADMIN' || user?.role === 'OWNER'`

4. **Organization badge for incomplete setup:**
   - Query organization data to check if setup is incomplete
   - Show small dot badge on Organization sub-tab if org name is empty or no members

5. **Sub-tab content rendering:**
   - profile: existing profile form content
   - organization: existing OrganizationTabContent
   - security: new SecurityTabContent

6. **Keep existing SubscriptionSettings at bottom of profile sub-tab**

UI pattern for sub-tabs:
```tsx
<div className="flex gap-2 border-b border-white/10 mb-6">
  {accountSubTabs.filter(tab => tab.id !== 'organization' || isAdminOrOwner).map(tab => (
    <button
      key={tab.id}
      onClick={() => setActiveAccountSubTab(tab.id)}
      className={cn(
        'px-4 py-2 text-sm font-medium border-b-2 -mb-px transition-colors',
        activeAccountSubTab === tab.id
          ? 'border-primary text-primary'
          : 'border-transparent text-muted-foreground hover:text-foreground'
      )}
    >
      <tab.icon className="h-4 w-4 mr-2 inline" />
      {tab.label}
    </button>
  ))}
</div>
```
  </action>
  <verify>
Settings page renders with sub-tabs under Account
Organization tab hidden for non-admin users (test by checking role)
TypeScript compiles: `cd quikadmin-web && bun run typecheck`
  </verify>
  <done>
Settings page restructured with Profile/Organization/Security sub-tabs, Organization conditionally visible.
  </done>
</task>

<task type="auto">
  <name>Task 3: Update navigation to remove Organization</name>
  <files>quikadmin-web/src/components/layout/AppLayout.tsx</files>
  <action>
Remove Organization from the main sidebar navigation:

1. **Verify baseNavigation array:**
   - Should NOT contain an Organization entry (it was already removed in Phase 6)
   - Confirm it only has: Dashboard, My Profile, Documents, History, Templates, Settings

2. **Add user dropdown link to Settings (optional enhancement):**
   - In the footer section where user avatar is shown
   - Avatar click could navigate to /settings (currently no action)
   - Make the entire user info section clickable: onClick={() => navigate('/settings')}

3. **Keep existing logout button separate**

The navigation should now be:
- Dashboard
- My Profile
- Documents
- History
- Templates
- Settings
(Plus admin-only: Form Analytics, Accuracy)

No Organization in sidebar - users access it via Settings > Account > Organization sub-tab.
  </action>
  <verify>
Sidebar does not show Organization nav item
User avatar/info section navigates to /settings when clicked
TypeScript compiles: `cd quikadmin-web && bun run typecheck`
App runs: `cd quikadmin-web && bun run dev` and verify sidebar
  </verify>
  <done>
Organization removed from sidebar, settings accessible via nav item and user dropdown.
  </done>
</task>

</tasks>

<verification>
1. Navigate to Settings page
2. Click on Account tab - should see Profile, Organization (if admin), Security sub-tabs
3. Default sub-tab is Profile
4. Security sub-tab shows password, 2FA, sessions sections
5. Organization sub-tab only visible for ADMIN/OWNER roles
6. Sidebar navigation has 6 items (no Organization)
7. Click user avatar in sidebar footer navigates to Settings
8. TypeScript compiles without errors
</verification>

<success_criteria>
- Settings page has Account with sub-tabs working correctly
- Organization sub-tab conditionally rendered based on role
- Security sub-tab is a proper security hub
- Navigation streamlined without Organization
- All existing functionality preserved
</success_criteria>

<output>
After completion, create `.planning/phases/08-polish/08-01-SUMMARY.md`
</output>
