---
phase: 08-polish
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - quikadmin-web/src/pages/ConnectedDashboard.tsx
  - quikadmin-web/src/stores/uiStore.ts
  - quikadmin-web/src/pages/TemplateLibrary.tsx
  - quikadmin-web/src/components/features/TemplateCard.tsx
  - quikadmin-web/src/services/formService.ts
autonomous: true

must_haves:
  truths:
    - "Dashboard stats can collapse to summary row"
    - "Collapse state persists across page navigation"
    - "Templates page shows favorites section at top"
    - "Clicking template card goes directly to form editor"
    - "Star icon on template cards toggles favorite status"
  artifacts:
    - path: "quikadmin-web/src/pages/ConnectedDashboard.tsx"
      provides: "Collapsible stats with summary row"
      contains: "statsCollapsed"
    - path: "quikadmin-web/src/stores/uiStore.ts"
      provides: "Dashboard collapse state persistence"
      contains: "dashboardStatsCollapsed"
    - path: "quikadmin-web/src/pages/TemplateLibrary.tsx"
      provides: "Favorites section and simplified flow"
      contains: "favorites"
  key_links:
    - from: "ConnectedDashboard.tsx"
      to: "uiStore.ts"
      via: "zustand state"
      pattern: "useDashboardStats|dashboardStatsCollapsed"
    - from: "TemplateLibrary.tsx"
      to: "formService.ts"
      via: "favorites API"
      pattern: "favoriteTemplate|unfavoriteTemplate"
---

<objective>
Add collapsible dashboard stats and simplify template flow with favorites.

Purpose: Reduce visual noise on dashboard for experienced users, streamline template selection for power users with favorites.
Output: Dashboard with collapsible stats, templates page with favorites and direct-to-editor flow.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/08-polish/08-CONTEXT.md

@quikadmin-web/src/pages/ConnectedDashboard.tsx
@quikadmin-web/src/stores/uiStore.ts
@quikadmin-web/src/pages/TemplateLibrary.tsx
@quikadmin-web/src/components/features/TemplateCard.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add collapsible stats to Dashboard</name>
  <files>quikadmin-web/src/pages/ConnectedDashboard.tsx, quikadmin-web/src/stores/uiStore.ts</files>
  <action>
Add collapsible stats dashboard with summary row:

**1. Update uiStore.ts:**
Add dashboard stats collapse state with localStorage persistence:
```typescript
interface UIState {
  // ... existing fields
  dashboardStatsCollapsed: boolean;
  setDashboardStatsCollapsed: (collapsed: boolean) => void;
  toggleDashboardStats: () => void;
}

// Add to store
dashboardStatsCollapsed: localStorage.getItem('dashboard-stats-collapsed') === 'true',
setDashboardStatsCollapsed: (collapsed) => {
  localStorage.setItem('dashboard-stats-collapsed', String(collapsed));
  set({ dashboardStatsCollapsed: collapsed });
},
toggleDashboardStats: () => {
  const newValue = !get().dashboardStatsCollapsed;
  localStorage.setItem('dashboard-stats-collapsed', String(newValue));
  set({ dashboardStatsCollapsed: newValue });
},
```

**2. Update ConnectedDashboard.tsx:**

a) Import and use the store state:
```typescript
const { dashboardStatsCollapsed, toggleDashboardStats } = useUIStore();
```

b) Create summary row component (shown when collapsed):
```tsx
const StatsSummaryRow = () => (
  <div className="glass-panel p-4 rounded-xl flex items-center justify-between">
    <div className="flex items-center gap-6 text-sm">
      <span className="flex items-center gap-2">
        <FileText className="h-4 w-4 text-muted-foreground" />
        <span className="font-medium">{statistics?.trends?.documents?.value || 0}</span>
        <span className="text-muted-foreground">documents</span>
      </span>
      <span className="text-muted-foreground">•</span>
      <span className="flex items-center gap-2">
        <CheckCircle className="h-4 w-4 text-status-success" />
        <span className="font-medium">{statistics?.trends?.processedToday?.value || 0}</span>
        <span className="text-muted-foreground">processed today</span>
      </span>
      <span className="text-muted-foreground">•</span>
      <span className="flex items-center gap-2">
        <Sparkles className="h-4 w-4 text-primary" />
        <span className="font-medium">{statistics?.successRate || 0}%</span>
        <span className="text-muted-foreground">success rate</span>
      </span>
    </div>
    <Button
      variant="ghost"
      size="sm"
      onClick={toggleDashboardStats}
      className="text-muted-foreground hover:text-foreground"
    >
      <ChevronDown className="h-4 w-4" />
      Expand
    </Button>
  </div>
);
```

c) Add toggle button to full stats grid:
```tsx
<div className="flex items-center justify-between mb-4">
  <h2 className="text-lg font-medium">Overview</h2>
  <Button
    variant="ghost"
    size="sm"
    onClick={toggleDashboardStats}
    className="text-muted-foreground hover:text-foreground"
  >
    <ChevronUp className="h-4 w-4 mr-1" />
    Collapse
  </Button>
</div>
```

d) Conditional render:
```tsx
{dashboardStatsCollapsed ? (
  <StatsSummaryRow />
) : (
  <>
    <div className="flex items-center justify-between mb-4">
      <h2 className="text-lg font-medium">Overview</h2>
      <Button variant="ghost" size="sm" onClick={toggleDashboardStats}>
        <ChevronUp className="h-4 w-4 mr-1" />
        Collapse
      </Button>
    </div>
    <ResponsiveGrid preset="stats" data-testid="dashboard-stats-grid">
      {/* existing StatCards */}
    </ResponsiveGrid>
  </>
)}
```

Import ChevronUp and ChevronDown from lucide-react.
  </action>
  <verify>
Dashboard stats can be collapsed and expanded
Collapsed state shows summary row with key metrics
State persists: refresh page, collapsed state remains
TypeScript compiles: `cd quikadmin-web && bun run typecheck`
  </verify>
  <done>
Dashboard has collapsible stats with summary row, state persists in localStorage.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add favorites to templates and simplify flow</name>
  <files>quikadmin-web/src/pages/TemplateLibrary.tsx, quikadmin-web/src/components/features/TemplateCard.tsx, quikadmin-web/src/services/formService.ts</files>
  <action>
Simplify template flow and add favorites:

**1. Add favorites to formService.ts:**
```typescript
// Get user's favorite template IDs (stored in localStorage for now)
export function getFavoriteTemplateIds(): string[] {
  const stored = localStorage.getItem('favorite-templates');
  return stored ? JSON.parse(stored) : [];
}

// Toggle template favorite status
export function toggleTemplateFavorite(templateId: string): boolean {
  const favorites = getFavoriteTemplateIds();
  const index = favorites.indexOf(templateId);
  if (index === -1) {
    favorites.push(templateId);
  } else {
    favorites.splice(index, 1);
  }
  localStorage.setItem('favorite-templates', JSON.stringify(favorites));
  return index === -1; // returns true if now favorited
}

// Check if template is favorited
export function isTemplateFavorited(templateId: string): boolean {
  return getFavoriteTemplateIds().includes(templateId);
}
```

**2. Update TemplateCard.tsx:**
Add favorite toggle button:
- Add `isFavorite?: boolean` and `onToggleFavorite?: (id: string) => void` to props
- Add Star icon button in card header (next to actions menu)
- Star filled yellow when favorited, outline when not
```tsx
import { Star } from 'lucide-react';

// In props
isFavorite?: boolean;
onToggleFavorite?: (id: string) => void;

// In card header (grid view)
{onToggleFavorite && (
  <Button
    variant="ghost"
    size="icon"
    onClick={(e) => {
      e.stopPropagation();
      onToggleFavorite(template.id);
    }}
    className={cn(
      'h-8 w-8',
      isFavorite ? 'text-yellow-500' : 'text-muted-foreground hover:text-yellow-500'
    )}
  >
    <Star className={cn('h-4 w-4', isFavorite && 'fill-current')} />
  </Button>
)}
```

**3. Update TemplateLibrary.tsx:**

a) Remove preview modal usage:
- Remove `previewTemplateId`, `isPreviewOpen`, `setIsPreviewOpen` states
- Remove `handlePreview` function
- Remove `TemplatePreviewModal` component import and JSX
- Change `onPreview` in TemplateCard to undefined or remove

b) Add favorites state:
```typescript
const [favoriteIds, setFavoriteIds] = useState<string[]>(getFavoriteTemplateIds);

const handleToggleFavorite = (id: string) => {
  const nowFavorited = toggleTemplateFavorite(id);
  setFavoriteIds(getFavoriteTemplateIds());
  toast.success(nowFavorited ? 'Added to favorites' : 'Removed from favorites');
};
```

c) Separate favorites from other templates:
```typescript
const favoriteTemplates = filteredTemplates.filter(t => favoriteIds.includes(t.id));
const otherTemplates = filteredTemplates.filter(t => !favoriteIds.includes(t.id));
```

d) Render favorites section at top:
```tsx
{favoriteTemplates.length > 0 && (
  <div className="mb-8">
    <h3 className="text-sm font-medium text-muted-foreground mb-4 flex items-center gap-2">
      <Star className="h-4 w-4 text-yellow-500 fill-yellow-500" />
      Favorites
    </h3>
    <ResponsiveGrid preset="cards">
      {favoriteTemplates.map((template) => (
        <TemplateCard
          key={template.id}
          template={template}
          viewMode={viewMode}
          isFavorite={true}
          onToggleFavorite={handleToggleFavorite}
          onEdit={handleEdit}
          onDuplicate={handleDuplicate}
          onDelete={handleDelete}
          onUse={handleTemplateClick}
          onClick={handleTemplateClick}
        />
      ))}
    </ResponsiveGrid>
  </div>
)}
```

e) Update click handler to go directly to form editor:
- `handleTemplateClick` already navigates to `/fill-form` with templateId
- Remove `onPreview` prop from TemplateCard instances
- Card click and Use button both go to form editor

f) Update remaining templates section:
```tsx
{otherTemplates.length > 0 && (
  <div>
    {favoriteTemplates.length > 0 && (
      <h3 className="text-sm font-medium text-muted-foreground mb-4">All Templates</h3>
    )}
    <ResponsiveGrid preset="cards">
      {otherTemplates.map((template) => (
        <TemplateCard
          key={template.id}
          template={template}
          viewMode={viewMode}
          isFavorite={false}
          onToggleFavorite={handleToggleFavorite}
          onEdit={handleEdit}
          onDuplicate={handleDuplicate}
          onDelete={handleDelete}
          onUse={handleTemplateClick}
          onClick={handleTemplateClick}
        />
      ))}
    </ResponsiveGrid>
  </div>
)}
```

Import Star from lucide-react, add getFavoriteTemplateIds, toggleTemplateFavorite, isTemplateFavorited imports.
  </action>
  <verify>
Templates page shows Favorites section at top when favorites exist
Star button on template cards toggles favorite status
Clicking template card navigates directly to /fill-form (no preview modal)
Preview modal no longer renders
Favorites persist after page refresh
TypeScript compiles: `cd quikadmin-web && bun run typecheck`
  </verify>
  <done>
Templates page has favorites, direct-to-editor flow, preview modal removed.
  </done>
</task>

</tasks>

<verification>
1. Dashboard stats can collapse to summary row with key metrics
2. Collapsed state persists across page refresh
3. Toggle button works both ways (expand/collapse)
4. Templates page shows Favorites section at top
5. Star button on cards toggles favorite status
6. Favoriting shows toast notification
7. Clicking template goes directly to fill-form page
8. No preview modal appears anywhere
9. TypeScript compiles without errors
</verification>

<success_criteria>
- Dashboard collapsible with persistent state
- Summary row shows documents count, processed today, success rate
- Template favorites working with localStorage
- Direct template-to-form flow (no preview modal)
- All existing functionality preserved
</success_criteria>

<output>
After completion, create `.planning/phases/08-polish/08-02-SUMMARY.md`
</output>
