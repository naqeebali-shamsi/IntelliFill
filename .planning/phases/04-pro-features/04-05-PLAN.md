---
phase: 04-pro-features
plan: 05
type: execute
wave: 3
depends_on: ['04-02', '04-03']
files_modified:
  - quikadmin/src/api/admin-accuracy.routes.ts
  - quikadmin/src/index.ts
  - quikadmin-web/src/services/adminService.ts
  - quikadmin-web/src/pages/AdminAccuracyDashboard.tsx
  - quikadmin-web/src/App.tsx
autonomous: false
---

<objective>
Build Admin dashboard for accuracy metrics and AI agent performance tracking.

Purpose: Admins need visibility into OCR accuracy, AI agent performance, and user feedback to identify issues and improve system quality.

Output: Admin-only dashboard with accuracy metrics, agent performance comparison, and feedback analysis.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
@~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-pro-features/04-02-SUMMARY.md
@.planning/phases/04-pro-features/04-03-SUMMARY.md

# Existing models with accuracy data (no schema changes needed):

# - UserFeedback: accuracyRating, isCorrect, fieldsFeedback

# - AgentMetrics: agentName, success, confidenceScore, qualityScore, processingTimeMs

# - Document: confidence, status

# Existing admin patterns:

@quikadmin/src/api/security-dashboard.routes.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create admin-accuracy.routes.ts</name>
  <files>quikadmin/src/api/admin-accuracy.routes.ts, quikadmin/src/index.ts</files>
  <action>
Create admin-only routes for accuracy metrics.

Use authenticateSupabase + requireRole('ADMIN') middleware pattern from security-dashboard.routes.ts.

Endpoints:

1. `GET /api/admin/accuracy/overview`
   Returns:

   ```typescript
   {
     overallAccuracy: number, // % of documents marked correct by users
     averageConfidence: number, // Average OCR confidence (0-1)
     totalFeedbackCount: number,
     feedbackByRating: { 1: number, 2: number, 3: number, 4: number, 5: number },
     accuracyTrend: Array<{ date: string, accuracy: number }>, // Last 30 days
     documentsByCategory: Array<{ category: string, count: number, avgConfidence: number }>
   }
   ```

2. `GET /api/admin/accuracy/agents`
   Returns agent performance comparison:

   ```typescript
   {
     agents: Array<{
       agentName: string;
       totalProcessed: number;
       successRate: number;
       avgProcessingTimeMs: number;
       avgConfidenceScore: number;
       avgQualityScore: number;
     }>;
   }
   ```

3. `GET /api/admin/accuracy/feedback?limit=20&offset=0`
   Returns paginated user feedback for review:
   ```typescript
   {
     feedback: Array<{
       id: string,
       userId: string,
       documentId: string,
       accuracyRating: number,
       isCorrect: boolean,
       comments: string | null,
       createdAt: string
     }>,
     total: number,
     limit: number,
     offset: number
   }
   ```

Query UserFeedback, AgentMetrics, Document tables.
Register routes: `app.use('/api/admin/accuracy', createAdminAccuracyRoutes())`
</action>
<verify>`cd quikadmin && npm run build` succeeds</verify>
<done>Admin accuracy routes created with overview, agents, and feedback endpoints</done>
</task>

<task type="auto">
  <name>Task 2: Extend adminService.ts</name>
  <files>quikadmin-web/src/services/adminService.ts</files>
  <action>
Create or extend adminService for accuracy endpoints.

If adminService.ts doesn't exist, create it. If it exists, extend it.

Interface definitions:

```typescript
interface AccuracyOverview {
  overallAccuracy: number;
  averageConfidence: number;
  totalFeedbackCount: number;
  feedbackByRating: Record<number, number>;
  accuracyTrend: Array<{ date: string; accuracy: number }>;
  documentsByCategory: Array<{ category: string; count: number; avgConfidence: number }>;
}

interface AgentPerformance {
  agents: Array<{
    agentName: string;
    totalProcessed: number;
    successRate: number;
    avgProcessingTimeMs: number;
    avgConfidenceScore: number;
    avgQualityScore: number;
  }>;
}

interface FeedbackItem {
  id: string;
  userId: string;
  documentId: string;
  accuracyRating: number;
  isCorrect: boolean;
  comments: string | null;
  createdAt: string;
}
```

Service methods:

- `getAccuracyOverview(): Promise<AccuracyOverview>`
- `getAgentPerformance(): Promise<AgentPerformance>`
- `getFeedback(params: { limit?: number; offset?: number }): Promise<{ feedback: FeedbackItem[]; total: number }>`

Handle 403 errors (non-admin access) gracefully.
</action>
<verify>TypeScript compiles</verify>
<done>adminService exports accuracy methods with proper typing</done>
</task>

<task type="auto">
  <name>Task 3: Build AdminAccuracyDashboard.tsx</name>
  <files>quikadmin-web/src/pages/AdminAccuracyDashboard.tsx, quikadmin-web/src/App.tsx</files>
  <action>
Create admin-only accuracy dashboard page.

Layout:

1. PageHeader: "Accuracy Dashboard" with admin badge

2. Overview Cards (grid):
   - Overall Accuracy (% with trend indicator)
   - Average Confidence (0-100% scale)
   - Total Feedback Count

3. Accuracy Trend Section:
   - Simple CSS bar chart showing last 30 days
   - Highlight days with accuracy drops

4. Agent Performance Table:
   - Columns: Agent Name, Processed, Success Rate, Avg Time, Avg Confidence, Quality Score
   - Sortable by any column
   - Highlight best/worst performers with color

5. Document Category Breakdown:
   - List showing categories with count and average confidence
   - Bar indicator showing confidence level

6. Recent Feedback Section:
   - Paginated table of recent user feedback
   - Shows: Rating (stars), Correct (yes/no badge), Comments (truncated), Date
   - Expand row to see full details

Access control:

- Check user role on mount
- If not ADMIN, show access denied message
- Use existing auth store to check role

Add route in App.tsx: `/admin/accuracy` -> AdminAccuracyDashboard
Route should be inside protected route group.

Components: Card, Table, Badge, PageHeader, Button (pagination)
Icons: Shield, TrendingUp, Users, FileCheck, Star
</action>
<verify>`bun run build` succeeds</verify>
<done>AdminAccuracyDashboard page renders with metrics, agent performance, and feedback</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Admin-only accuracy dashboard with OCR accuracy metrics, AI agent performance comparison, and user feedback review</what-built>
  <how-to-verify>
    1. Ensure backend and frontend running
    2. Log in as ADMIN user (test-admin@intellifill.local / TestAdmin123!)
    3. Navigate to: http://localhost:8080/admin/accuracy
    4. Verify:
       - Overview cards display accuracy metrics (may show 0/N/A if no data)
       - Accuracy trend chart renders (or empty state)
       - Agent performance table shows any tracked agents
       - Document category breakdown displays
       - Recent feedback section shows any user feedback
    5. Test access control:
       - Log out and log in as non-admin user
       - Navigate to /admin/accuracy
       - Verify access denied message shown
  </how-to-verify>
  <resume-signal>Type "approved" to continue, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `cd quikadmin && npm run build` succeeds
- [ ] `cd quikadmin-web && bun run build` succeeds
- [ ] `/admin/accuracy` route accessible to admin users
- [ ] Access denied shown to non-admin users
- [ ] Metrics display correctly (or empty states)
- [ ] Agent performance table renders
- [ ] User approved visual layout
</verification>

<success_criteria>

- All tasks completed
- Admin dashboard functional and access-controlled
- Metrics from UserFeedback and AgentMetrics displayed
- User approved visual/functional verification
  </success_criteria>

<output>
After completion, create `.planning/phases/04-pro-features/04-05-SUMMARY.md`
</output>
