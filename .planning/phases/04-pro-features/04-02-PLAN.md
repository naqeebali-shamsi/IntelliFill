---
phase: 04-pro-features
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - quikadmin/src/api/form-analytics.routes.ts
  - quikadmin/src/index.ts
  - quikadmin-web/src/services/formAnalyticsService.ts
autonomous: true
---

<objective>
Create form usage analytics backend endpoint and frontend service.

Purpose: PRO agents need visibility into which forms are used most frequently and field completion rates to optimize their workflow.

Output: Backend analytics endpoint and frontend service ready for UI consumption.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Existing models to query (no schema changes needed):

# - FilledForm: tracks form generation with templateId, clientId, status

# - Template: form templates with usageCount

# - ClientProfile: tracks field sources

# Existing patterns:

@quikadmin/src/api/stats.routes.ts
@quikadmin-web/src/services/smartProfileService.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create form-analytics.routes.ts</name>
  <files>quikadmin/src/api/form-analytics.routes.ts, quikadmin/src/index.ts</files>
  <action>
Create backend routes for form analytics.

Endpoints:

1. `GET /api/form-analytics/overview` (authenticateSupabase)
   Returns aggregate stats for authenticated user:

   ```typescript
   {
     totalFormsGenerated: number,
     formsThisMonth: number,
     formsThisWeek: number,
     topTemplates: Array<{
       templateId: string,
       templateName: string,
       count: number,
       lastUsed: string
     }>,
     statusBreakdown: {
       draft: number,
       completed: number,
       submitted: number
     }
   }
   ```

   Query FilledForm grouped by templateId, join Template for names.
   Use date ranges for week/month counts.

2. `GET /api/form-analytics/templates/:templateId` (authenticateSupabase)
   Returns analytics for specific template:

   ```typescript
   {
     templateId: string,
     templateName: string,
     totalUsage: number,
     usageByMonth: Array<{ month: string, count: number }>,
     averageCompletionTime: number | null,
     clientsUsing: number
   }
   ```

3. `GET /api/form-analytics/trends` (authenticateSupabase)
   Returns usage trends (last 30 days):
   ```typescript
   {
     daily: Array<{ date: string, count: number }>,
     weeklyAverage: number,
     trend: 'up' | 'down' | 'stable'
   }
   ```

Register routes in index.ts: `app.use('/api/form-analytics', createFormAnalyticsRoutes())`

Use existing patterns from stats.routes.ts for query structure.
</action>
<verify>`cd quikadmin && npm run build` succeeds</verify>
<done>form-analytics routes created with overview, template-specific, and trends endpoints</done>
</task>

<task type="auto">
  <name>Task 2: Create formAnalyticsService.ts</name>
  <files>quikadmin-web/src/services/formAnalyticsService.ts</files>
  <action>
Create frontend service to consume form analytics API.

Interface definitions:

```typescript
interface FormAnalyticsOverview {
  totalFormsGenerated: number;
  formsThisMonth: number;
  formsThisWeek: number;
  topTemplates: Array<{
    templateId: string;
    templateName: string;
    count: number;
    lastUsed: string;
  }>;
  statusBreakdown: {
    draft: number;
    completed: number;
    submitted: number;
  };
}

interface TemplateAnalytics {
  templateId: string;
  templateName: string;
  totalUsage: number;
  usageByMonth: Array<{ month: string; count: number }>;
  averageCompletionTime: number | null;
  clientsUsing: number;
}

interface UsageTrends {
  daily: Array<{ date: string; count: number }>;
  weeklyAverage: number;
  trend: 'up' | 'down' | 'stable';
}
```

Service methods:

- `getOverview(): Promise<FormAnalyticsOverview>`
- `getTemplateAnalytics(templateId: string): Promise<TemplateAnalytics>`
- `getTrends(): Promise<UsageTrends>`

Follow existing service patterns with error handling.
</action>
<verify>TypeScript compiles: `cd quikadmin-web && bun run build`</verify>
<done>formAnalyticsService.ts exports overview, template, and trends methods with proper typing</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `cd quikadmin && npm run build` succeeds
- [ ] `cd quikadmin-web && bun run build` succeeds
- [ ] Backend endpoints respond with expected structure (test with curl if server running)
</verification>

<success_criteria>

- All tasks completed
- Backend routes registered and functional
- Frontend service typed and ready for UI
- No TypeScript errors in either package
  </success_criteria>

<output>
After completion, create `.planning/phases/04-pro-features/04-02-SUMMARY.md`
</output>
