---
phase: 04-pro-features
plan: 04
type: execute
wave: 2
depends_on: ['04-01']
files_modified:
  - quikadmin-web/src/pages/SmartProfile.tsx
  - quikadmin-web/src/components/smart-profile/ClientSelector.tsx
  - quikadmin-web/src/stores/smartProfileStore.ts
autonomous: false
---

<objective>
Integrate client management with SmartProfile wizard for seamless client-profile workflow.

Purpose: PRO agents need to easily save extracted profiles to existing clients or create new clients directly from the Smart Profile flow.

Output: SmartProfile wizard can save to existing client or create new client on completion.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
@~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-pro-features/04-01-SUMMARY.md

# Client service from 04-01:

@quikadmin-web/src/services/clientsService.ts
@quikadmin-web/src/stores/clientsStore.ts

# SmartProfile to modify:

@quikadmin-web/src/pages/SmartProfile.tsx
@quikadmin-web/src/stores/smartProfileStore.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add client state to smartProfileStore</name>
  <files>quikadmin-web/src/stores/smartProfileStore.ts</files>
  <action>
Extend smartProfileStore with client selection/creation state.

Add to state:

- `selectedClientId: string | null` - Existing client to save to
- `newClientName: string | null` - Name for new client creation
- `clientMode: 'existing' | 'new' | null` - Which mode user chose

Add actions:

- `selectExistingClient(clientId: string)` - Select existing client
- `setNewClientName(name: string)` - Set name for new client
- `clearClientSelection()` - Reset client state
- `setClientMode(mode: 'existing' | 'new' | null)` - Set mode

On reset(), also clear client state.
</action>
<verify>TypeScript compiles</verify>
<done>smartProfileStore extended with client selection state and actions</done>
</task>

<task type="auto">
  <name>Task 2: Create ClientSelector component</name>
  <files>quikadmin-web/src/components/smart-profile/ClientSelector.tsx</files>
  <action>
Create component for selecting existing client or creating new one.

Props:

- `onSelectExisting: (clientId: string) => void`
- `onCreateNew: (name: string) => void`
- `onCancel: () => void`
- `selectedClientId?: string`
- `defaultName?: string` - Pre-fill from extracted profile data

UI Structure:

1. Two-tab or radio group: "Save to Existing Client" / "Create New Client"

2. Existing Client tab:
   - Search input for client name (uses clientsService.getClients with search param)
   - Scrollable list of matching clients (max 5-10 shown)
   - Each item shows: name, type badge, document count
   - Click to select, visual highlight on selected

3. New Client tab:
   - Name input (pre-filled with extracted person name if available)
   - Type select (INDIVIDUAL default, COMPANY option)
   - Validation: name required

4. Action buttons: "Cancel", "Save to Client" (disabled until selection/input valid)

Use existing components: Input, Button, Select, Badge, Card
Use debounced search (300ms) for client lookup.
</action>
<verify>TypeScript compiles</verify>
<done>ClientSelector component renders with existing/new client selection</done>
</task>

<task type="auto">
  <name>Task 3: Integrate ClientSelector into SmartProfile wizard</name>
  <files>quikadmin-web/src/pages/SmartProfile.tsx</files>
  <action>
Add client selection to the profile step in SmartProfile wizard.

Integration points:

1. In the profile step (after ProfileView renders):
   - Add "Save to Client" button below the profile
   - Clicking opens ClientSelector (can be inline expansion or modal)

2. When user confirms selection:
   - If existing client: Call clientsService to merge profile
   - If new client: Call clientsService.createClient, then merge profile
   - Show toast on success: "Profile saved to {clientName}"

3. Update profile step UI:
   - Show "Saved to: {clientName}" badge if client is selected
   - Allow changing client selection

4. On wizard reset: Clear client selection

Backend integration note:

- Profile merge happens via existing `/api/clients/:clientId/profile` PUT endpoint
- New client creation via `/api/clients` POST endpoint
- Wire these through clientsService

Keep it simple - don't over-engineer. The primary goal is connecting Smart Profile output to client management.
</action>
<verify>`bun run build` succeeds</verify>
<done>SmartProfile profile step has "Save to Client" functionality</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>SmartProfile wizard integration with client management - can save extracted profile to existing or new client</what-built>
  <how-to-verify>
    1. Ensure backend and frontend running
    2. Navigate to: http://localhost:8080/smart-profile
    3. Upload a document (use any test PDF)
    4. Progress through wizard to profile step
    5. Test existing client flow:
       - Click "Save to Client"
       - Select "Save to Existing Client" tab
       - Search for a client (if any exist)
       - Select one and confirm
       - Verify toast shows success
    6. Test new client flow:
       - Click "Save to Client" again (or refresh wizard)
       - Select "Create New Client" tab
       - Enter a name
       - Confirm creation
       - Verify toast shows success
       - Verify client appears in /clients page
  </how-to-verify>
  <resume-signal>Type "approved" to continue, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `cd quikadmin-web && bun run build` succeeds
- [ ] "Save to Client" button appears in profile step
- [ ] Can search and select existing client
- [ ] Can create new client with name
- [ ] Profile merges to selected client
- [ ] User approved the integration flow
</verification>

<success_criteria>

- All tasks completed
- SmartProfile connects to client management
- Both existing and new client flows work
- User approved visual/functional verification
  </success_criteria>

<output>
After completion, create `.planning/phases/04-pro-features/04-04-SUMMARY.md`
</output>
